webpackJsonp([19],{SzWL:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("hr"),t._v(" "),a("h2",{attrs:{id:"name%3A-mongodb%E5%AE%9E%E6%88%98layout%3A-posttitle%3A-%22mongodb%E5%AE%9E%E6%88%98%22info%3A-%22mongodb%E5%AE%9E%E6%88%98%22date%3A-2019-05-05categories%3A-worktags%3A-%5Bmongodb%5Dcoverimg%3A-%22https%3A%2F%2Fws1.sinaimg.cn%2Flarge%2F88b26e1cgy1fx7cwh57tlj22kw3vc1ky.jpg%22"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#name%3A-mongodb%E5%AE%9E%E6%88%98layout%3A-posttitle%3A-%22mongodb%E5%AE%9E%E6%88%98%22info%3A-%22mongodb%E5%AE%9E%E6%88%98%22date%3A-2019-05-05categories%3A-worktags%3A-%5Bmongodb%5Dcoverimg%3A-%22https%3A%2F%2Fws1.sinaimg.cn%2Flarge%2F88b26e1cgy1fx7cwh57tlj22kw3vc1ky.jpg%22","aria-hidden":"true"}},[t._v("#")]),t._v(' name: MongoDB实战\nlayout: post\ntitle:  "MongoDB实战"\ninfo: "MongoDB实战"\ndate:   2019-05-05\ncategories: WORK\ntags: [MongoDB]\ncoverimg: "https://ws1.sinaimg.cn/large/88b26e1cgy1fx7cwh57tlj22kw3vc1ky.jpg"')]),t._v(" "),a("h2",{attrs:{id:"1.%E5%85%A8%E6%96%B0%E7%9A%84web%E6%95%B0%E6%8D%AE%E5%BA%93"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#1.%E5%85%A8%E6%96%B0%E7%9A%84web%E6%95%B0%E6%8D%AE%E5%BA%93","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.全新的web数据库")]),t._v(" "),a("ul",[a("li",[t._v("MongoDB的设计目标之一是保留大部分关系型数据库的功能")]),t._v(" "),a("li",[t._v("ad hoc queries 系统支持主动查询模式是指不需要事前定义系统接收何种查询")]),t._v(" "),a("li",[t._v("MongoDB中的索引使用B-树数据结构")]),t._v(" "),a("li",[t._v("MongoDB允许多个辅助索引，可以允许用户优化不同的查询")]),t._v(" "),a("li",[t._v("MongoDB每个集合中可创建64个索引，升序，降序，复合键，哈希，文本，地理空间索引")]),t._v(" "),a("li",[t._v("用户可选择写入语义来维持速度与持久性之间的平衡")]),t._v(" "),a("li",[t._v(".csv文件为comma-separated values 逗号分隔数据")]),t._v(" "),a("li",[t._v(".tsv使用制表符的分割的数据")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("数据库类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("实例")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("数据类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("伸缩性模型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("使用场景")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("简单键值存储")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Memcached")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("键值，值是二进制对象")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("变化的Memcached可以跨节点伸缩，可把所有可用的RAM变为一个存储库")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("缓存，Web网站")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("复查键值存储")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Hbase,Cassandra,Riak,Redis,CouchDB")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("变化的Cassandra使用的键值结构是列，Hbase和Redis存储二进制对象，CouchDB存储JSON文档")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("最终一致性，多节点，分布式高可用和容易灾备")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("高吞吐（活动源，消息队列），缓存，Web网站")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("关系型数据库")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Oracle,IBM DB2,Microsoft SQl Server, MySQl, PostgreSQl")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("二维表")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("垂直伸缩，限制支持集群和手动分区")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("需要事务的系统（银行和金融）或SQL，规范化数据模型")])])])]),t._v(" "),a("h3",{attrs:{id:"%E9%80%9A%E8%BF%87js-shell-%E6%93%8D%E4%BD%9Cmongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E9%80%9A%E8%BF%87js-shell-%E6%93%8D%E4%BD%9Cmongodb","aria-hidden":"true"}},[t._v("#")]),t._v(" 通过JS shell 操作MongoDB")]),t._v(" "),a("ul",[a("li",[t._v("MongoDB数据库中所有的集合分组在相同的文件中")]),t._v(" "),a("li",[t._v("MongoDB shell 同时也是js解释执行器")]),t._v(" "),a("li",[t._v("下面代码在name集合中插入20000条数据")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("for (i =0, i<20000, i++ ) {\n    db.name.save({num:1});\n}\n")])]),t._v(" "),a("h3",{attrs:{id:"%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9Cmongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9Cmongodb","aria-hidden":"true"}},[t._v("#")]),t._v(" 编写代码操作MongoDB")]),t._v(" "),a("ul",[a("li",[t._v("所有MongoDB驱动都执行三个重要功能")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("1. 生成MongoDB对象id,默认都存储在所有文档的_id字段中\n2. 驱动会将任意语言表示的文档对象转换为BSON或者从BSON转换回来，BSON为MongoDB使用的二进制JSON格式\n3. 使用TCP socket与数据库连接通信，使用MongoDB自定义协议，socket通信的风格，特别是写入数据等待应答是非常重要的\n")])]),t._v(" "),a("ul",[a("li",[t._v("mongo中_id是是在驱动中生成，而不是在服务器上生成，关系型数据库在服务器端自增主键，因此导致服务器生成主键可能成为瓶颈")]),t._v(" "),a("li",[t._v('MongoDB中_id的组成为"Unix时间戳"+"机器ID"+"进程ID"+"计数器"，目的是在多个驱动生成ID并插入文档时ID为唯一')])]),t._v(" "),a("h3",{attrs:{id:"%E9%9D%A2%E5%90%91%E6%96%87%E6%A1%A3%E7%9A%84%E6%95%B0%E6%8D%AE"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E9%9D%A2%E5%90%91%E6%96%87%E6%A1%A3%E7%9A%84%E6%95%B0%E6%8D%AE","aria-hidden":"true"}},[t._v("#")]),t._v(" 面向文档的数据")]),t._v(" "),a("ul",[a("li",[t._v("字符串类型必须使用utf-8编码")]),t._v(" "),a("li",[t._v("数字支持三种数据类型，double,int,long,这意味着BSON可以编码任意IEEE浮点值以及任意8B长度的有符号整数")]),t._v(" "),a("li",[t._v("时间，从Unix纪元计时时开始时间值使用64b整数的毫秒值表示，负数表示之前的时间")]),t._v(" "),a("li",[t._v("文档的限制BSON文档大小限制为16MB原因有二")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("1. 阻止开发者创建无意义的数据模型，MongoDB更适合管理小文件\n2. 16MB的限制与性能相关，查询大文档在发送给客户端之前要把文档拷贝到缓存中，代价昂贵，网络传输代价和反序列化代价\n")])]),t._v(" "),a("ul",[a("li",[t._v("MongoDB文档的嵌套深度最大限制为100，深层嵌套数据结构通常都通过递归函数访问，可能会导致堆栈溢出")]),t._v(" "),a("li",[t._v("大量插入的最大限制为16MB")])]),t._v(" "),a("h3",{attrs:{id:"5.-%E6%9E%84%E5%BB%BA%E6%9F%A5%E8%AF%A2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#5.-%E6%9E%84%E5%BB%BA%E6%9F%A5%E8%AF%A2","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. 构建查询")]),t._v(" "),a("ul",[a("li",[t._v("$slice 返回文档的子集")]),t._v(" "),a("li",[t._v("排序sort,创建索引是提升排序效率的关键")]),t._v(" "),a("li",[t._v("跳过和限制，skip后的数字不应太大，很大的数字会造成大量的扫描")])]),t._v(" "),a("h3",{attrs:{id:"6.-%E8%81%9A%E5%90%88"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#6.-%E8%81%9A%E5%90%88","aria-hidden":"true"}},[t._v("#")]),t._v(" 6. 聚合")]),t._v(" "),a("ul",[a("li",[t._v("略")])]),t._v(" "),a("h3",{attrs:{id:"7.-%E6%9B%B4%E6%96%B0%EF%BC%8C%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%92%8C%E5%88%A0%E9%99%A4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#7.-%E6%9B%B4%E6%96%B0%EF%BC%8C%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C%E5%92%8C%E5%88%A0%E9%99%A4","aria-hidden":"true"}},[t._v("#")]),t._v(" 7. 更新，原子操作和删除")]),t._v(" "),a("ul",[a("li",[t._v("替换整个文档和操作符修改，替换操作简单，操作符方式性能好")]),t._v(" "),a("li",[t._v("乐观锁是一种确保干净更新数据但是不需要锁定数据的技术，wiki实现，可能同时有多个用户同时更新wiki页面，但是又绝不希望有用户更新已经过时的页面信息")]),t._v(" "),a("li",[t._v("悲观锁为记录会在事物里第一次访问时被锁定，直到事物结束，在此期间无法进行其他事务访问")]),t._v(" "),a("li",[t._v("原子文档处理")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("原子更新就是一个不会被其他更新中断或者与其他操作互动的操作，在此期间此条数据是不可见状态，每个MongoDB更新都是原子操作\nfindAndModify会返回文档更新前的数据\n")])]),t._v(" "),a("h3",{attrs:{id:"8.-%E7%B4%A2%E5%BC%95%E7%90%86%E8%AE%BA"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#8.-%E7%B4%A2%E5%BC%95%E7%90%86%E8%AE%BA","aria-hidden":"true"}},[t._v("#")]),t._v(" 8. 索引理论")]),t._v(" "),a("ul",[a("li",[t._v("索引规则")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("1. 索引可以大大减少要处理的文档数量\n2. 唯一的单键索引将会用来处理查询\n3. 如果有一个复合索引a-b，那么a上的索引就是多余的，b上的不多于\n4. 复合索引的键值顺序很重要\n")])]),t._v(" "),a("ul",[a("li",[t._v("单键索引，每个索引入口对应文档索引里的单个值")]),t._v(" "),a("li",[t._v("虽然索引对于查询性能非常重要，但每个新的索引都需要额外的维护成本")]),t._v(" "),a("li",[t._v("使用MMAPv1存储引擎时，使用系统调用mmap()方法，MongoDB高速操作系统把所有的数据文件映射到内存中")]),t._v(" "),a("li",[t._v("使用WiredTiger引擎使用不同的方式，包含所有文档，集合和索引的数据文件，被操作系统加载和移除RAM，按照4K的大小移动，无论是否需要页上的数据，操作系统都必须确保RAM中的数据页可用")]),t._v(" "),a("li",[t._v("至少要确保所有加载到RAM中，所有要适当创建的索引")]),t._v(" "),a("li",[t._v("MongoDB绝大部分索引使用B—数据结构")]),t._v(" "),a("li",[t._v("B—树有两大特点使它非常适合作为数据库索引")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("1. 方便了各种查询，包括精确匹配，范围条件查询，排序，前缀匹配，索引查询\n2. 它在添加和删除键值之后都会保持平衡\n")])]),t._v(" "),a("ul",[a("li",[t._v("唯一索引")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("db.user.createIndex({username:1},{unique:true})\n")])]),t._v(" "),a("ul",[a("li",[t._v("稀疏索引")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("db.user.createIndex({username:1},{unique:true,sparse:true})\n")])]),t._v(" "),a("ul",[a("li",[t._v("哈希索引")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v("db.user.createIndex({username:'hashd'})\n哈希索引限制\n1. 等值查询相似，不支持范围查询\n2. 不支持多键哈希\n3. 浮点数在哈希之前转换为整数\n")])]),t._v(" "),a("ul",[a("li",[t._v("当有键值数据不均匀分布时，哈希函数可以创建均匀性")])]),t._v(" "),a("h3",{attrs:{id:"9.-%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#9.-%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2","aria-hidden":"true"}},[t._v("#")]),t._v(" 9. 文本搜索")]),t._v(" "),a("ul",[a("li",[t._v("略")])]),t._v(" "),a("h3",{attrs:{id:"10.-wiredtiger%E4%B8%8E%E5%8F%AF%E6%8B%94%E6%8F%92%E5%AD%98%E5%82%A8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#10.-wiredtiger%E4%B8%8E%E5%8F%AF%E6%8B%94%E6%8F%92%E5%AD%98%E5%82%A8","aria-hidden":"true"}},[t._v("#")]),t._v(" 10. WiredTiger与可拔插存储")]),t._v(" "),a("ul",[a("li",[t._v("略")])]),t._v(" "),a("h3",{attrs:{id:"11.-%E5%A4%8D%E5%88%B6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#11.-%E5%A4%8D%E5%88%B6","aria-hidden":"true"}},[t._v("#")]),t._v(" 11. 复制")]),t._v(" "),a("ul",[a("li",[t._v("略")])]),t._v(" "),a("h3",{attrs:{id:"12.-%E4%BD%BF%E7%94%A8%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4%E6%8B%93%E5%B1%95%E7%B3%BB%E7%BB%9F"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#12.-%E4%BD%BF%E7%94%A8%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4%E6%8B%93%E5%B1%95%E7%B3%BB%E7%BB%9F","aria-hidden":"true"}},[t._v("#")]),t._v(" 12. 使用分片集群拓展系统")]),t._v(" "),a("ul",[a("li",[t._v("略")])]),t._v(" "),a("h3",{attrs:{id:"13.-%E9%83%A8%E7%BD%B2%E5%92%8C%E7%AE%A1%E7%90%86"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#13.-%E9%83%A8%E7%BD%B2%E5%92%8C%E7%AE%A1%E7%90%86","aria-hidden":"true"}},[t._v("#")]),t._v(" 13. 部署和管理")]),t._v(" "),a("ul",[a("li",[t._v("略")])])])}]},i=a("VU/8")(null,v,!1,null,null,null);e.default=i.exports}});
//# sourceMappingURL=19.79d5d13813f42a3f0fcc.js.map