webpackJsonp([20],{"U8j+":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("hr"),t._v(" "),a("h2",{attrs:{id:"name%3A-mongodb-client%E6%93%8D%E4%BD%9Clayout%3A-posttitle%3A-%22mongodb-client%E6%93%8D%E4%BD%9C%22info%3A-%22mongodb-client%E6%93%8D%E4%BD%9C%22date%3A-2019-05-05categories%3A-worktags%3A-%5Bmongodb%5Dcoverimg%3A-%22https%3A%2F%2Fws1.sinaimg.cn%2Flarge%2F88b26e1cgy1fx7cwh57tlj22kw3vc1ky.jpg%22"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#name%3A-mongodb-client%E6%93%8D%E4%BD%9Clayout%3A-posttitle%3A-%22mongodb-client%E6%93%8D%E4%BD%9C%22info%3A-%22mongodb-client%E6%93%8D%E4%BD%9C%22date%3A-2019-05-05categories%3A-worktags%3A-%5Bmongodb%5Dcoverimg%3A-%22https%3A%2F%2Fws1.sinaimg.cn%2Flarge%2F88b26e1cgy1fx7cwh57tlj22kw3vc1ky.jpg%22","aria-hidden":"true"}},[t._v("#")]),t._v(' name: MongoDB Client操作\nlayout: post\ntitle:  "MongoDB Client操作"\ninfo: "MongoDB Client操作"\ndate:   2019-05-05\ncategories: WORK\ntags: [MongoDB]\ncoverimg: "https://ws1.sinaimg.cn/large/88b26e1cgy1fx7cwh57tlj22kw3vc1ky.jpg"')]),t._v(" "),a("h2",{attrs:{id:"mongodb-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C","aria-hidden":"true"}},[t._v("#")]),t._v(" MongoDB 客户端操作")]),t._v(" "),a("h3",{attrs:{id:"%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E9%9B%86%E5%90%88"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E9%9B%86%E5%90%88","aria-hidden":"true"}},[t._v("#")]),t._v(" 查看数据库和集合")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("show dbs")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输出所有数据库")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("show collections")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输出当前数据库所有集合")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输出当前所在数据库")])])])]),t._v(" "),a("h3",{attrs:{id:"%E5%88%9B%E5%BB%BA%E9%9B%86%E5%90%88"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E5%88%9B%E5%BB%BA%E9%9B%86%E5%90%88","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建集合")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v('db.createCollection("名字")')]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建collection")])])])]),t._v(" "),a("h3",{attrs:{id:"%E6%8F%92%E5%85%A5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E6%8F%92%E5%85%A5","aria-hidden":"true"}},[t._v("#")]),t._v(" 插入")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.insert({id:2, name:'小说'})")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("插入数据")])])])]),t._v(" "),a("h3",{attrs:{id:"%E5%88%A0%E9%99%A4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E5%88%A0%E9%99%A4","aria-hidden":"true"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.dropDatabase();")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除当前使用数据库")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.drop();")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("清空name表数据")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.remove({id:2})")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除id=2的记录")])])])]),t._v(" "),a("h3",{attrs:{id:"%E4%BF%AE%E6%94%B9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E4%BF%AE%E6%94%B9","aria-hidden":"true"}},[t._v("#")]),t._v(" 修改")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.update({id:2},{$set:{name:'fffjr'}},false,true)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("更新所有id=2的记录的name=fffjr")])])])]),t._v(" "),a("p",[t._v("参数说明：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("序号")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("{id:2}")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("匹配id=2的数据")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("{$set:{name:'fffjr'}}")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("将name字段更新为fffjr")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("false")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("如果没有匹配是否将2的数据插入集合中，默认为false不插入,true为插入")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("4")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("true")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("是否更新所有匹配，默认为false更新第一条匹配，true为更新所有匹配")])])])]),t._v(" "),a("h3",{attrs:{id:"%E6%99%AE%E9%80%9A%E6%9F%A5%E8%AF%A2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E6%99%AE%E9%80%9A%E6%9F%A5%E8%AF%A2","aria-hidden":"true"}},[t._v("#")]),t._v(" 普通查询")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("对应SQL")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find();")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * form name;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v('db.name.distinct("name");')]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select distinct name from name;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v('db.name.find({"age": 22});')]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age=22;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({age: {$ne: 22}});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age!=22;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({age: {$gt: 22}});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age>22;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({age: {$lt: 22}});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age<22;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({age: {$gte: 22}});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age>=22;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({age: {$lte: 22}});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age<=22;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({age: {$gle: 22, $lte: 27}});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age>=22 and age<=27;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({}, {name:1, age:1});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select name, age from name; false未不显示，否则为显示")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({age: {$gt:27}}, {name:1, age:1});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select name,age from name where age>27;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find().sort({age:1});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("按照age升序排列输出")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find().sort({age:-1});")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("按照age倒序排列输出")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v('db.name.find({"name": "fanjr", "age": 22});')]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where name='fanjr' and age=22;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find().limit(2);")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name limit 2;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find().skip(10);")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("跳过前十条数据")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find().limit(10).skip(5)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查询5-10条记录")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({$or: [{age:22}, {age:25}]);")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("select * from name where age=22 or age=25;")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find().limit(10).count();")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回个数为所有符合条件查询结果个数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find().limit(10).count(1);")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("返回limit之后的个数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.find({name: /f/})")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('select * from name where name like "%f%";')])])])]),t._v(" "),a("h3",{attrs:{id:"aggregate%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aggregate%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2","aria-hidden":"true"}},[t._v("#")]),t._v(" aggregate聚合查询")]),t._v(" "),a("ul",[a("li",[t._v("以org_id分组，输出大于1的分组")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v('db.album_albums.aggregate([\n    {$group: {_id: "$org_id", num: {$sum: 1}}},\n    {$match: {num: {$gt: 1}}}\n])\n')])]),t._v(" "),a("h4",{attrs:{id:"%E5%B8%B8%E7%94%A8%E7%AE%A1%E9%81%93%E7%AC%A6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E5%B8%B8%E7%94%A8%E7%AE%A1%E9%81%93%E7%AC%A6","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用管道符")]),t._v(" "),a("ul",[a("li",[t._v("$group：将集合中的文档分组，可用于统计结果")]),t._v(" "),a("li",[t._v("$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作")]),t._v(" "),a("li",[t._v("$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档")])]),t._v(" "),a("h4",{attrs:{id:"%E5%B8%B8%E7%94%A8%E8%81%9A%E5%90%88%E8%A1%A8%E8%BE%BE%E5%BC%8F"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E5%B8%B8%E7%94%A8%E8%81%9A%E5%90%88%E8%A1%A8%E8%BE%BE%E5%BC%8F","aria-hidden":"true"}},[t._v("#")]),t._v(" 常用聚合表达式")]),t._v(" "),a("ul",[a("li",[t._v("$sum: 计算总和")]),t._v(" "),a("li",[t._v("$avg: 计算平均值")]),t._v(" "),a("li",[t._v("$min: 获取最小值")]),t._v(" "),a("li",[t._v("$max: 获取最大值")]),t._v(" "),a("li",[t._v("$first: 获取第一个文档数据")]),t._v(" "),a("li",[t._v("$last: 获取最后一个文档数据")])]),t._v(" "),a("h3",{attrs:{id:"%E7%B4%A2%E5%BC%95"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E7%B4%A2%E5%BC%95","aria-hidden":"true"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("命令")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("功能")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.getIndexes()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("查询当前集合所有索引")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.ensureIndex({id:1})")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建id为索引 1为升序，-1为倒序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.ensureIndex({id:1, name:1})")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建id和name为联合索引")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v('db.name.dropIndex("id_1")')]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除指定索引")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.dropIndexes()")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("删除所有索引")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("db.name.ensureIndex({id:-1},{unique:true})")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("创建唯一约束")])])])]),t._v(" "),a("h3",{attrs:{id:"mongo%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%98%BE%E7%A4%BA%E6%9F%A5%E8%AF%A2%E7%BB%93%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongo%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%98%BE%E7%A4%BA%E6%9F%A5%E8%AF%A2%E7%BB%93%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F","aria-hidden":"true"}},[t._v("#")]),t._v(" mongo客户端格式化显示查询结两种方式")]),t._v(" "),a("ul",[a("li",[t._v("查询语句最后增加.pretty()")]),t._v(" "),a("li",[t._v("修改MongoDB客户端的配置文件~/.mongorc.js，重新连接MongoDB客户端生效")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v('echo "DBQuery.prototype._prettyShell = true" >> ~/.mongorc.js\n')])]),t._v(" "),a("h3",{attrs:{id:"mongodb%E9%81%8D%E5%8E%86%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb%E9%81%8D%E5%8E%86%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B","aria-hidden":"true"}},[t._v("#")]),t._v(" MongoDB遍历修改字段类型")]),t._v(" "),a("ul",[a("li",[t._v("将org_id的值类型又int更改为string")])]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v('db.album_albums.find({"org_id": {$type:16}}).forEach(function(doc) {\n    db.album_albums.updateOne({_id: doc._id},{$set: {"org_id": String(doc.org_id)}})\n})\n')])]),t._v(" "),a("h3",{attrs:{id:"%E4%B8%8B%E7%BA%BF%E9%9F%B3%E9%A2%91src%E5%AD%97%E6%AE%B5%E4%B8%8D%E6%98%AFurl%E7%9A%84%E5%AF%B9%E5%BA%94%E4%B8%93%E8%BE%91"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#%E4%B8%8B%E7%BA%BF%E9%9F%B3%E9%A2%91src%E5%AD%97%E6%AE%B5%E4%B8%8D%E6%98%AFurl%E7%9A%84%E5%AF%B9%E5%BA%94%E4%B8%93%E8%BE%91","aria-hidden":"true"}},[t._v("#")]),t._v(" 下线音频src字段不是url的对应专辑")]),t._v(" "),a("pre",{pre:!0,attrs:{class:"hljs"}},[a("code",[t._v('db.album_chapters.find().forEach(function(doc) {\n    if(doc.src!=""){\n        var reg=/(http|ftp|https):\\/\\/[\\w\\-_]+(\\.[\\w\\-_]+)+([\\w\\-\\.,@?^=%&:/~\\+#]*[\\w\\-\\@?^=%&/~\\+#])?/;\n        if(!reg.test(doc.src)){\n            db.album_albums.updateOne({abid: doc.abid},{$set: {"status": "off-urlless"}})\n        }   \n    }\n})\n')])])])}]},i=a("VU/8")(null,l,!1,null,null,null);e.default=i.exports}});
//# sourceMappingURL=20.398f59fa6903671438c9.js.map