---
name: 程序员的自我修养
layout: post
title:  "程序员的自我修养"
info: "程序员的自我修养"
date:   2019-05-05
categories: WORK
tags: [Linux, 读书]
coverimg: "https://ws1.sinaimg.cn/large/88b26e1cgy1fx7cwh57tlj22kw3vc1ky.jpg"
---


## 1. 温故而知新
- 计算机三大核心部件 1.CPU， 2.内存，3.I/O控制芯片
- 为了协调CPU，内存和高速图形设备设计了高速北桥芯片
- 为低速设备（串口设备）设计了南桥芯片，又南桥汇总后了连接到北桥
- 摩尔定律于2004年失效，CPU主频由于制作工艺被限制在4GHz
- 现在处理器采用多核心共享高速缓存来实现多核处理器实现SMP的简化版
- 计算机科学领域的任何问题都可以增加一个中间件来解决
- 操作系统的一个功能是提供抽象接口，另一个主要功能是管理硬件资源
- 所有的应用程序都以进程的形式运行在比操作系统权限更低的级别，每个进程有独立的地址空间
- CPU由操作系统统一分配，每个进程根据进程优先级的高低都有机会获得执行的机会，运行时间超过时间片则更换，操作系统可以强制剥夺CPU资源并且分配给它认为最需要的进程，这种CPU分配方式叫做抢占式
- 操作系统作为硬件层的上层，它是对硬件层的管理和抽象
- 线程总是并发执行，当线程数量小于等于CPU核数，线程的并发是真正的并发
- I/O密集型线程比CPU密集型更容易得到更高优先级
- 线程优先级改变方式1.用户指定优先级，2.根据进入等待状态的频繁程度提升或者降低优先级，3.长时间得不到执行而被提升优先级
- 线程安全：同步和锁

## 2. 编译和链接
- 预编译
```
1. 展开所有宏定义
2. 递归处理预编译指令
3. 删除所有注释
4. 添加行号和文件标识
```
- 编译
```
1. 词法分析，运用一种有限状态机的算法，将源码分割为一系列记号，关键字，标识符，字面量，特殊符号
2. 语法分析，语法分析器采用上下文无关语法的分析手段，生成以表达式为节点的语法树
3. 语义分析，语义分析器将整个语法树的表达式都标识类型
4. 优化及生成汇编代码
```
- 汇编
```
1. 汇编器将汇编代码转化为机器码
```
- 链接
```
1. 模块的拼接过程就是链接
2. 链接过程主要包括地址和空间分配，符号决议，重定位
```
## 3. 目标文件里有什么
- 程序源码被编译后主要分为两种段，程序指令和程序数据
- 程序被装载后，数据和指令被分别映射到两个虚存区域，数据区域对进程来讲是可读写的，指令区对进程来讲是只读的，防止程序指令被修改
- 程序的指令和数据被分开存放可提高CPU缓存命中率
- 当系统运行多份该程序则只需一份指令

## 4. 静态链接
- 现代链接器空间分配采用两步链接的方法
- 第一步空间于地址分配，扫描所有的输入目标文件，获得他们各个段的长度，属性和位置，并且将输入目标文件中的符号定义和符号引用搜集起来，统一放到一个全局符号表，链接器将能获得所有输入目标文件的长度，并且将它们合并，计算出输出文件中各个段合并后的长度和位置，并建立映射关系
- 第二部符号解析和重定位，使用第一步收集的所有信息，读取输入文件中段的数据和重定位信息，并且进行符号解析和重定位，调整代码中的地址

## 5. 动态链接
- 为了解决空间浪费和更新困难，将链接过程提迟到程序运行时在链接，这就是动态链接的思想

## 6. Linux共享库的组织
- linux共享库主要存放在三个位置
```
1. /lib，主要存放系统最关键和基础的共享库，主要是那些/bin和/sbin下的程序所用到的库，还有系统启动时所需的库
2. /usr/lib, 保存非系统运行时所需的关键性共享库，主要是开发时用到的共享库，一般不会被用户程序和shell脚本直接用到
3. /usr/local/lib, 主要存放跟操作系统无关的库，GNU的标准推荐第三方的应用程序默认安装在/usr/local/lib下
4. /lib, /usr/lib下是一些常用的成熟的，系统本身所需要的库，/usr/local/lib下为非系统所需的第三方程序共享库
```
## 7. 内存
- 内存是承载程序运行的介质，也是程序运行各种运算和表达的场所
- 应用程序在内存空间中有如下默认区域
```
1. 栈：栈用于维护函数调用的上下文，栈通常会在用户空间的最高地址处分配，通常为数兆字节大小
2. 堆：堆是用来容纳应用程序动态分配的内存区域，当程序使用malloc或new来分配内存时，得到的内存来自堆里，堆通常位于栈的下方，堆比栈大很多，可以有几十到数百兆
3. 可执行文件映像：储存可执行文件映像
4. 保留区：对内存中受到保护而禁止访问的内存区域的总称
```
- 程序向操作系统提前申请一块大小合适的堆空间，然后由程序自己管理这块空间
- 堆的分配算法
```
1. 空闲链表，请求时遍历，直到找到大小合适的块并且拆分给它，将释放空间加入空闲链表
2. 位图：核心思想为将整个堆划分为大量的大小相同的块，当用户请求，分配给用户整数个块
3. 对象池：如每次请求的大小一致则将整个堆分为同单位的小块，每次请求分配一个单位小块
```
## 8. 运行库
- 用户通过某个函数打开文件获得文件描述符或者句柄，此后用户操作文件皆通过该文件描述符进行
- 内核可通过文件描描述符来计算内核里文件对象的地址，但不对用户开放
- 每个进程维护一个私有打开文件表，这个表是一个指针数组，每一个元素都指向一个内核打开的文件对象，fd就是下标
- 缓冲：为提高性能，提出缓冲区概念，flush将缓冲内的数据全部写入文件，并将缓冲区清空，全缓冲：出用户手动flush外，当缓冲区满，缓冲才会被flush掉。行缓冲：针对文本文件，在输入遇到换行符时，执行flush

## 9. 系统调用于API
- 中断一般具有两个属性，中断号和中断处理程序，在内核中有一个数组成为中断向量表，在中断触发，CPU会暂停当前执行的代码，根据中断号，查询中断处理程序并调用它，中断处理程序执行完之后，CPU继续执行之前的代码
- 中断的两种类型，硬件中断，软件中断

#### 粗略翻看感兴趣点，略过实现部分